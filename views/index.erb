<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîê Assinatura Digital Leve ‚Äî Gerar Token</title>
  <style>
    :root {
      --bg: #ffffff;
      --text: #2d3748;
      --border: #e2e8f0;
      --primary: #3182ce;
      --success: #48bb78;
      --danger: #e53e3e;
      --light-bg: #f8fafc;
      --card-bg: #ffffff;
    }

    [data-theme="dark"] {
      --bg: #1a202c;
      --text: #e2e8f0;
      --border: #4a5568;
      --light-bg: #2d3748;
      --card-bg: #2d3748;
    }

    .theme-toggle {
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      max-width: 700px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 2rem;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      color: var(--primary);
    }

    .subtitle {
      color: var(--text);
      opacity: 0.8;
    }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }

    .form-group {
      margin-bottom: 16px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--light-bg);
      color: var(--text);
      font-size: 16px;
    }

    .card button,
    form button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      font-weight: 600;
      width: 100%;
      transition: opacity 0.2s;
    }

    button:hover {
      opacity: 0.9;
    }

    .alert {
      padding: 16px;
      border-radius: 8px;
      margin: 16px 0;
    }

    .alert-error {
      background: #fee;
      border: 1px solid var(--danger);
      color: var(--danger);
    }

    .alert-success {
      background: #eff;
      border: 1px solid var(--success);
      color: var(--success);
    }

    .token-container {
      position: relative;
      margin: 16px 0;
    }

    .token {
      font-family: monospace;
      word-break: break-all;
      background: var(--light-bg);
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 40px;
    }

    .copy-btn {
      position: absolute;
      bottom: -36px;
      right: 4px;
      background: var(--primary);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }

    .copy-btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    footer {
      text-align: center;
      margin-top: 32px;
      font-size: 0.9rem;
      opacity: 0.7;
    }

    a {
      color: var(--primary);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      min-width: 44px;
      min-height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: background 0.3s, transform 0.2s;
      padding: 8px; /* ‚Üê importante para dar espa√ßo ao √≠cone */
    }

    .theme-toggle:hover {
      transform: scale(1.1);
      background: var(--light-bg);
    }
    .theme-toggle svg {
      width: 44px;
      height: 44px;
    }

  </style>
</head>
<body>
  <div class="container">
    <!-- Bot√£o de altern√¢ncia de tema -->
    <button id="theme-toggle" class="theme-toggle" aria-label="Alternar tema"></button>

    <header>
      <h1>üîê Assinatura Digital Leve</h1>
      <p class="subtitle">Gere um token assinado com seus dados pessoais (simula√ß√£o educacional)</p>
    </header>

    <main>
      <% if @erro %>
        <div class="alert alert-error"><strong>Erro:</strong> <%= @erro %></div>
      <% end %>

      <div class="card">
        <form method="post" action="/gerar">
          <div class="form-group">
            <label for="cpf">CPF *</label>
            <input type="text" id="cpf" name="cpf" value="<%= params[:cpf] || '' %>" placeholder="000.000.000-00" required>
          </div>

          <div class="form-group">
            <label for="nome">Nome Completo *</label>
            <input type="text" id="nome" name="nome" value="<%= params[:nome] || '' %>" placeholder="Jo√£o Silva" required>
          </div>

          <div class="form-group">
            <label for="email">E-mail (opcional)</label>
            <input type="email" id="email" name="email" value="<%= params[:email] || '' %>" placeholder="joao@exemplo.com">
          </div>

          <button type="submit">Gerar Token Seguro</button>
        </form>
      </div>

      <% if @token %>
        <div class="card">
          <h2>‚úÖ Token Gerado com Sucesso!</h2>
          <p>Este token expira em <strong>10 minutos</strong> e pode ser verificado na p√°gina de valida√ß√£o.</p>
          
          <div class="token-container">
            <div class="token" id="tokenOutput"><%= @token %></div>
            <button 
              class="copy-btn " 
              onclick="copyToken()"
              title="Copiar token para a √°rea de transfer√™ncia"
            >
              üìã Copiar
            </button>
          </div>
          
          <p style="margin-top: 20px;">
            <a href="/validar">Verificar este token agora</a>
          </p>
        </div>

        <script>
          function copyToken() {
            const token = document.getElementById('tokenOutput').innerText;
            navigator.clipboard.writeText(token).then(() => {
              const btn = document.querySelector('.copy-btn');
              btn.innerText = '‚úÖ Copiado!';
              btn.style.backgroundColor = '#48bb78';
              setTimeout(() => {
                btn.innerText = 'üìã Copiar';
                btn.style.backgroundColor = '';
              }, 2000);
            }).catch(err => {
              alert('Falha ao copiar: ' + err);
            });
          }
        </script>
      <% end %>
    </main>

    <footer>
      <p>Feito com ‚ù§Ô∏è em Ruby | Assinatura Digital Leve (projeto educacional)</p>
      <p><a href="/validar">ou valide um token existente</a></p>
    </footer>
  </div>

  <!-- Script de altern√¢ncia de tema -->
  <script>
  // √çcones como strings (seguro e simples)
  const sunIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
  <circle cx="12" cy="12" r="5"/>
  <line x1="12" y1="1" x2="12" y2="3"/>
  <line x1="12" y1="21" x2="12" y2="23"/>
  <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
  <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
  <line x1="1" y1="12" x2="3" y2="12"/>
  <line x1="21" y1="12" x2="23" y2="12"/>
  <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
  <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
</svg>`;

const moonIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="none" aria-hidden="true">
  <path d="M21.3796 16.6459C19.3195 17.1807 17.1426 17.0444 15.1654 16.2566C13.1883 15.4689 11.514 14.0709 10.3862 12.266C9.25833 10.4611 8.73577 8.34339 8.89449 6.221C9.05322 4.09861 9.88495 2.08222 11.2687 0.465139C9.74886 0.8594 8.3432 1.60601 7.16555 2.64453C5.9879 3.68305 5.07134 4.9843 4.4901 6.4429C3.90885 7.90151 3.67924 9.4765 3.81986 11.0403C3.96048 12.6042 4.46738 14.1129 5.29952 15.4445C6.13149 16.7761 7.26534 17.8931 8.60928 18.705C9.95321 19.5169 11.4694 20.001 13.0352 20.118C14.601 20.235 16.1724 19.9816 17.622 19.3784C19.0717 18.7752 20.359 17.8391 21.3796 16.6459Z"/>
</svg>`;

  function applyTheme(theme) {
    const toggleBtn = document.getElementById('theme-toggle');
    if (theme === 'dark') {
      document.documentElement.setAttribute('data-theme', 'dark');
      localStorage.setItem('theme', 'dark');
      toggleBtn.innerHTML = sunIcon; // ‚òÄÔ∏è
    } else {
      document.documentElement.setAttribute('data-theme', 'light');
      localStorage.setItem('theme', 'light');
      toggleBtn.innerHTML = moonIcon; // üåô
    }
  }

  function initTheme() {
    const savedTheme = localStorage.getItem('theme');
    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const theme = savedTheme || (systemPrefersDark ? 'dark' : 'light');
    applyTheme(theme);
  }

  function toggleTheme() {
    const current = document.documentElement.getAttribute('data-theme');
    const newTheme = current === 'dark' ? 'light' : 'dark';
    applyTheme(newTheme);
  }

  document.addEventListener('DOMContentLoaded', () => {
    initTheme();
    document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
  });
</script>
</body>
</html>